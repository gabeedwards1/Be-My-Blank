<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Be My ___ ‚Äî Holiday Message Generator</title>
<style>
  :root{
    --bg:#0f1220; --panel:#11152b; --ink:#e8ecff; --muted:#b9c0d9; --accent:#7aa2ff; --ring:rgba(122,162,255,.35);
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%}
  body{
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background: radial-gradient(1200px 600px at 20% -10%, #182042 0%, var(--bg) 60%);
    color:var(--ink); line-height:1.5;
    display:flex; align-items:flex-start; justify-content:center; padding:24px;
  }
  .wrap{width:min(960px,100%); display:grid; gap:16px}
  .card{background:var(--panel); border-radius:var(--radius); padding:20px 22px; box-shadow:0 15px 60px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.05)}
  h1{font-size:1.8rem; margin:6px 0 8px}
  h2{font-size:1.25rem; margin:0 0 8px}
  p{margin:0 0 10px}
  .sub{color:var(--muted)}
  .row{display:grid; gap:12px; grid-template-columns:1fr 1fr}
  .row > * {min-width:0}
  label{font-size:.9rem; color:var(--muted); display:block; margin:10px 0 6px}
  input[type=date]{width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#0d1123; color:var(--ink); outline:none}
  .chk{display:flex; gap:10px; align-items:center}
  button{
    appearance:none; border:none; cursor:pointer; border-radius:12px; padding:10px 14px; color:#000;
    background:var(--accent); font-weight:600; box-shadow:0 6px 16px var(--ring)
  }
  button.secondary{background:#252b4a; color:var(--ink)}
  .flex{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .list{display:grid; gap:10px}
  .pill{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:100px; background:#151a33; border:1px solid rgba(255,255,255,.08); font-size:.9rem}
  .out{white-space:pre-wrap; background:#0b0f1f; border:1px dashed rgba(255,255,255,.15); padding:12px; border-radius:12px; min-height:48px}
  .muted{color:var(--muted)}
  .right{margin-left:auto}
  .hero h1{letter-spacing:.2px}
  .hero .badges{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
  .badge{background:#0c1021; border:1px solid rgba(255,255,255,.08); padding:6px 10px; border-radius:999px; font-size:.85rem; color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <section class="card hero">
      <h1>Forgot to ask? We got you.</h1>
      <p>
        <strong>Fellas</strong>, have you ever forgotten to ask your girl to be your <em>pumpkin</em> on Halloween‚Äîor your
        <em>parrot</em> for Talk Like a Pirate Day?
      </p>
      <p class="sub">
        Pick a date, we look up the absurd and ridiculous holiday and write a message like:
        ‚ÄúBe my pi ü•ß ‚Äî Happy Pi Day!‚Äù You hit <strong>Copy</strong>, paste anywhere, boom.
      </p>
    </section>

    <section class="card">
      <h2>Be My ___ ‚Äî Holiday Message Generator</h2>
      <p class="sub">Pick a date. We‚Äôll pull holidays from your JSON and craft the message.</p>

      <div class="row" style="margin-top:6px">
        <div>
          <label for="date">Date</label>
          <input id="date" type="date" />
        </div>
        <div>
          <label>&nbsp;</label>
          <div class="flex">
            <button id="go">Generate</button>
            <button id="today" class="secondary">Today</button>
            <button id="random" class="secondary">Random Holiday üé≤</button>
          </div>
        </div>
      </div>

      <div class="flex" style="margin-top:10px">
        <label class="chk"><input type="checkbox" id="includeFun" checked/> <span>Include ‚Äúsilly‚Äù holidays</span></label>
        <label class="chk"><input type="checkbox" id="bundle"/> <span>One combined message per day</span></label>
        <span class="right muted" id="status"></span>
      </div>

      <div class="card" style="margin-top:14px">
        <div class="flex">
          <strong>Holidays found</strong>
        </div>
        <div id="holidays" class="list" style="margin-top:10px"></div>
      </div>

      <div class="card" style="margin-top:14px">
        <div class="flex">
          <strong>Generated message(s)</strong>
          <div class="right flex">
            <button id="copy">Copy</button>
          </div>
        </div>
        <div id="output" class="out" style="margin-top:10px"></div>
      </div>
    </section>
  </div>

<script>
/* ---------- minimal built-in fun map as fallback ---------- */
const FUN_HOLIDAYS_MIN = {
  "01-01":["New Year‚Äôs Day (Fun)","Bloody Mary Day"],
  "02-14":["Valentine‚Äôs (Fun)","International Book Giving Day"],
  "03-14":["Pi Day","Potato Chip Day"],
  "03-17":["St. Patrick‚Äôs (Fun)"],
  "04-01":["April Fools‚Äô Day"],
  "05-04":["Star Wars Day"],
  "06-01":["Say Something Nice Day"],
  "09-19":["Talk Like a Pirate Day"],
  "10-09":["Leif Erikson Day"],
  "10-31":["Halloween (Fun)"],
  "11-13":["World Kindness Day"],
  "11-23":["Espresso Day"],
  "12-25":["Christmas (Fun)"]
};

/* ---------- local-date utils ---------- */
function toYMDLocal(d){const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),day=String(d.getDate()).padStart(2,'0');return `${y}-${m}-${day}`;}
function fromInputLocal(v){if(!v)return new Date();const [y,m,d]=v.split('-').map(Number);return new Date(y,m-1,d,12,0,0);}
function todayInputValue(){return toYMDLocal(new Date());}
function titleCase(s){return (s||"").replace(/\b([a-z])/g,m=>m.toUpperCase());}
function ymdToLocalDate(ymd){const [y,m,d]=ymd.split('-').map(Number);return new Date(y,m-1,d,12,0,0);}

/* ---------- DOM ---------- */
const dateEl=document.getElementById('date');
const statusEl=document.getElementById('status');
const holidaysEl=document.getElementById('holidays');
const outputEl=document.getElementById('output');
const includeFunEl=document.getElementById('includeFun');
const bundleEl=document.getElementById('bundle');
dateEl.value=todayInputValue();

/* ---------- JSON stores ---------- */
let FUN_BY_DATE = {};             // from fun_holidays_by_date.json (keyed YYYY-MM-DD)
let HOLIDAY_EMOJIS = {};          // from holiday_emojis_2025.json (per-date emoji picks)
let EMOJI_DATA = [];              // optional Unicode list (fallback)

/* ---------- loaders ---------- */
async function loadFunJson(){
  try{
    const res = await fetch('./fun_holidays_by_date.json', {cache:'no-store'});
    FUN_BY_DATE = await res.json();
    console.log(`Loaded ${Object.keys(FUN_BY_DATE).length} fun-holiday dates.`);
  }catch(e){
    console.warn("fun_holidays_by_date.json not found; will fall back to built-in minimal map.", e);
  }
}
async function loadHolidayEmojiJson(){
  try{
    const res = await fetch('./holiday_emojis_2025.json', {cache:'no-store'});
    HOLIDAY_EMOJIS = await res.json();
    console.log(`Loaded ${Object.keys(HOLIDAY_EMOJIS).length} holiday emoji dates.`);
  }catch(e){
    console.warn("holiday_emojis_2025.json not found; emoji will be generated via fallback.", e);
  }
}
async function loadUnicodeEmoji(){
  try{
    const res = await fetch('./emoji.json', {cache:'no-store'});
    EMOJI_DATA = await res.json();
    console.log(`Loaded ${EMOJI_DATA.length} Unicode emojis for fallback.`);
  }catch(e){
    console.warn("emoji.json not found; using default fallback emojis only.", e);
  }
}

/* ---------- tiny NLP to pick a natural noun after ‚ÄúBe my ‚Ä¶‚Äù ---------- */
const OVERRIDE_NOUN = {
  "Talk Like Yoda Day": "Yoda",
  "International Talk Like a Pirate Day": "pirate",
  "Talk Like a Pirate Day": "pirate",
  "Pi Day": "pi",
  "Tau Day": "tau",
  "Festival of Sleep Day": "nap buddy",
  "Opposite Day": "contrarian",
  "World Kindness Day": "kindheart",
  "Hug Your Cat Day": "cat",
  "Towel Day": "towel",
  "Wright Brothers Day": "aviator",
  "Star Wars Day": "Jedi",
  "Donut Day": "donut",
  "Chocolate Chip Day": "cookie",
  "International Coffee Day": "coffee"
};
const STOP = new Set(["day","week","month","international","world","national","the","a","an","my","your","our","of","and","or","to","in","on","for","with","at","by","like","up"]);

function singularize(word){
  if (/ies$/.test(word)) return word.replace(/ies$/,"y");
  if (/ses$/.test(word)) return word.replace(/es$/,"");
  if (/s$/.test(word) && !/(ss|us|is)$/.test(word)) return word.slice(0,-1);
  return word;
}
function tokensFromName(name){
  return name
    .toLowerCase()
    .replace(/[‚Äú‚Äù"‚Äô']/g,"")
    .replace(/[^a-z0-9\s-]/g," ")
    .split(/\s+/)
    .filter(Boolean);
}
// Heuristics ranked by ‚Äúsounds natural‚Äù:
// 1) explicit overrides for weird/fandom days
// 2) ‚Äú‚Ä¶ like a/an X ‚Ä¶‚Äù  ‚Üí X
// 3) ‚Äú‚Ä¶ of X‚Äù / ‚Äú‚Ä¶ for X‚Äù ‚Üí X
// 4) rightmost meaningful token before ‚ÄúDay/Week/Month‚Äù
function pickBeMyNoun(holidayName){
  if (OVERRIDE_NOUN[holidayName]) return OVERRIDE_NOUN[holidayName];

  const base = holidayName.replace(/\s+(Day|Week|Month)$/i,"");
  const lower = base.toLowerCase();

  let m = lower.match(/talk\s+like\s+(?:a|an)\s+([a-z0-9][a-z0-9\s-]*)/);
  if (m) return titleCase(singularize(m[1].split(/\s+/)[0]));

  m = lower.match(/of\s+([a-z0-9][a-z0-9\s-]*)$/);
  if (m) return titleCase(singularize(m[1].split(/\s+/)[0]));

  m = lower.match(/for\s+([a-z0-9][a-z0-9\s-]*)$/);
  if (m) return titleCase(singularize(m[1].split(/\s+/)[0]));

  const toks = tokensFromName(base).filter(t => !STOP.has(t));
  if (toks.length){
    const noun = singularize(toks[toks.length-1]);
    return titleCase(noun);
  }
  return "buddy";
}

/* ---------- emoji helpers ---------- */
function tokenize(s){return (s||"").toLowerCase().replace(/['‚Äô]/g,"").match(/[a-z0-9]+/g)||[];}
function bestEmojisFromUnicode(name, maxEmojis=2){
  if(!EMOJI_DATA.length) return ["üéâ","ü•≥"];
  const query = tokenize(name).filter(w=>!["day","week","month","national","international","world","the","of","and"].includes(w));
  const scored=[];
  for(const e of EMOJI_DATA){
    const n=tokenize(e.name), sg=tokenize(e.subgroup), g=tokenize(e.group);
    let score=0;
    for(const w of query){
      if(n.includes(w)) score+=5; else if(sg.includes(w)) score+=3; else if(g.includes(w)) score+=2;
    }
    if(score>0) scored.push({emoji:e.emoji,score});
  }
  if(!scored.length) return ["üéâ"];
  scored.sort((a,b)=>b.score-a.score);
  const out=[], seen=new Set();
  for(const s of scored){ if(!seen.has(s.emoji)){ out.push(s.emoji); seen.add(s.emoji); if(out.length>=maxEmojis) break; } }
  return out.length?out:["üéâ"];
}

/* ---------- data fetchers (local only) ---------- */
function funNamesForDate(dateLocal){
  const ymd = toYMDLocal(dateLocal);
  const mmdd = ymd.slice(5);
  const fromFile = FUN_BY_DATE[ymd] || [];
  const builtin = FUN_HOLIDAYS_MIN[mmdd] || [];
  if(!includeFunEl.checked) return [];
  return [...fromFile, ...builtin].filter((v,i,a)=>a.indexOf(v)===i); // de-dupe
}

/* ---------- emoji selection per holiday ---------- */
function emojisForHoliday(ymd, name){
  const items = HOLIDAY_EMOJIS[ymd];
  if(items){
    const hit = items.find(it => (it.name||"").toLowerCase() === (name||"").toLowerCase());
    if(hit && hit.emojis){
      if (Array.isArray(hit.emojis)) return hit.emojis;
      return String(hit.emojis).split(/\s+/).filter(Boolean);
    }
  }
  return bestEmojisFromUnicode(name, 2);
}

/* ---------- message crafting ---------- */
function craftMessage(ymd, name){
  const noun = pickBeMyNoun(name);
  const ems = emojisForHoliday(ymd, name).slice(0,2).join(" ");
  return `Be my ${noun} ${ems} ‚Äî Happy ${name}!`;
}

/* ---------- core generate ---------- */
async function generate(){
  statusEl.textContent="Generating‚Ä¶";
  holidaysEl.innerHTML="";
  outputEl.textContent="";

  const dateLocal = fromInputLocal(dateEl.value);
  const ymd = toYMDLocal(dateLocal);

  const names = funNamesForDate(dateLocal);
  if(!names.length){
    holidaysEl.innerHTML = "<div class='muted'>No holidays found for this date.</div>";
    statusEl.textContent = "";
    return;
  }

  // pills
  names.forEach(n=>{
    const el=document.createElement('span'); el.className='pill'; el.textContent=n;
    holidaysEl.appendChild(el);
  });

  // messages
  let messages = names.map(n => craftMessage(ymd, n));
  if(bundleEl.checked){
    messages = [ names.map(n => "‚Ä¢ " + craftMessage(ymd, n)).join("\n") ];
  }
  outputEl.textContent = messages.join("\n\n");
  statusEl.textContent = `Generated ${messages.length} message${messages.length>1?'s':''}.`;
}

/* ---------- copy / random ---------- */
function copyOut(){
  const text = outputEl.textContent.trim(); if(!text) return;
  navigator.clipboard.writeText(text).then(()=>{ statusEl.textContent="Copied ‚úÖ"; });
}

document.getElementById('random').addEventListener('click', async ()=>{
  statusEl.textContent = "Picking a holiday date‚Ä¶";
  let eligible = Object.keys(FUN_BY_DATE);
  if(!eligible.length){
    const year = new Date().getFullYear();
    eligible = Object.keys(FUN_HOLIDAYS_MIN).map(mmdd => `${year}-${mmdd}`);
  }
  if(!eligible.length){ statusEl.textContent = "No dates available."; return; }
  const pick = eligible[Math.floor(Math.random()*eligible.length)];
  dateEl.value = pick;
  statusEl.textContent = `Random holiday picked: ${ymdToLocalDate(pick).toDateString()}`;
  generate();
});

/* ---------- events ---------- */
document.getElementById('go').addEventListener('click', generate);
document.getElementById('today').addEventListener('click', ()=>{ dateEl.value=todayInputValue(); generate(); });
document.getElementById('copy').addEventListener('click', copyOut);

/* ---------- startup ---------- */
(async()=>{
  await loadHolidayEmojiJson();  // per-date emoji mapping
  await loadFunJson();           // your scraped fun-holiday dates
  await loadUnicodeEmoji();      // optional fallback scoring
  generate();
})();
</script>
</body>
</html>
