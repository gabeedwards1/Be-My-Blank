<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Be My ___ ‚Äî Holiday Message Generator</title>
<style>
  :root{
    --bg:#0f1220; --panel:#11152b; --ink:#e8ecff; --muted:#b9c0d9; --accent:#7aa2ff; --ring:rgba(122,162,255,.35);
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%}
  body{
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background: radial-gradient(1200px 600px at 20% -10%, #182042 0%, var(--bg) 60%);
    color:var(--ink); line-height:1.5;
    display:flex; align-items:flex-start; justify-content:center; padding:24px;
  }
  .wrap{width:min(960px,100%); display:grid; gap:16px}
  .card{background:var(--panel); border-radius:var(--radius); padding:20px 22px; box-shadow:0 15px 60px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.05)}
  h1{font-size:1.8rem; margin:6px 0 8px}
  h2{font-size:1.25rem; margin:0 0 8px}
  p{margin:0 0 10px}
  .sub{color:var(--muted)}
  .row{display:grid; gap:12px; grid-template-columns:1fr 1fr 1fr}
  .row > * {min-width:0}
  label{font-size:.9rem; color:var(--muted); display:block; margin:10px 0 6px}
  select,input[type=date]{width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#0d1123; color:var(--ink); outline:none}
  .chk{display:flex; gap:10px; align-items:center}
  button{
    appearance:none; border:none; cursor:pointer; border-radius:12px; padding:10px 14px; color:#000;
    background:var(--accent); font-weight:600; box-shadow:0 6px 16px var(--ring)
  }
  button.secondary{background:#252b4a; color:var(--ink)}
  .flex{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .list{display:grid; gap:10px}
  .pill{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:100px; background:#151a33; border:1px solid rgba(255,255,255,.08); font-size:.9rem}
  .out{white-space:pre-wrap; background:#0b0f1f; border:1px dashed rgba(255,255,255,.15); padding:12px; border-radius:12px; min-height:48px}
  .muted{color:var(--muted)}
  .right{margin-left:auto}
  .footer{margin-top:14px; font-size:.85rem; color:var(--muted)}
  a{color:#aecdff}
  .hero h1{letter-spacing:.2px}
  .hero .badges{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
  .badge{background:#0c1021; border:1px solid rgba(255,255,255,.08); padding:6px 10px; border-radius:999px; font-size:.85rem; color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <section class="card hero">
      <h1>Forgot to ask? We got you.</h1>
      <p>
        <strong>Fellas</strong>, have you ever forgotten to ask your girl to be your <em>pumpkin</em> on Halloween‚Äîor your
        <em>parrot</em> for Talk Like a Pirate Day?
      </p>
      <p class="sub">
        Pick a date, we find the holiday (official <em>and</em> ridiculous), and we auto-write a playful line like:
        ‚ÄúBe my turkey ü¶É ‚Äî Happy Thanksgiving!‚Äù You hit <strong>Copy</strong>, paste into whatever app, and boom:
        seasonal romance secured.
      </p>
      <div class="badges">
        <span class="badge">Zero sign-in</span>
        <span class="badge">Copy-paste friendly</span>
        <span class="badge">Official + ‚Äúsilly‚Äù holidays</span>
        <span class="badge">Emoji-powered ‚ú®</span>
      </div>
    </section>

    <section class="card">
      <h2>Be My ___ ‚Äî Holiday Message Generator</h2>
      <p class="sub">Pick a date & country. We‚Äôll find holidays and craft copy-paste messages.</p>

      <div class="row" style="margin-top:6px">
        <div>
          <label for="date">Date</label>
          <input id="date" type="date" />
        </div>
        <div>
          <label for="country">Country (official holidays)</label>
          <select id="country"></select>
        </div>
        <div>
          <label>&nbsp;</label>
          <div class="flex">
            <button id="go">Generate</button>
            <button id="today" class="secondary">Today</button>
            <button id="random" class="secondary">Random Holiday üé≤</button>
          </div>
        </div>
      </div>

      <div class="flex" style="margin-top:10px">
        <label class="chk"><input type="checkbox" id="includeOfficial" checked/> <span>Include official holidays</span></label>
        <label class="chk"><input type="checkbox" id="includeFun" checked/> <span>Include ‚Äúsilly‚Äù holidays</span></label>
        <label class="chk"><input type="checkbox" id="bundle"/> <span>One combined message per day</span></label>
        <span class="right muted" id="status"></span>
      </div>

      <div class="card" style="margin-top:14px">
        <div class="flex">
          <strong>Holidays found</strong>
          <button id="shuffle" class="secondary right">Shuffle Emojis</button>
        </div>
        <div id="holidays" class="list" style="margin-top:10px"></div>
      </div>

      <div class="card" style="margin-top:14px">
        <div class="flex">
          <strong>Generated message(s)</strong>
          <div class="right flex">
            <button id="copy">Copy</button>
            <button id="regenerate" class="secondary">Regenerate</button>
          </div>
        </div>
        <div id="output" class="out" style="margin-top:10px"></div>
      </div>

      <div class="footer">
        Sources: Official holidays from <a href="https://date.nager.at/API" target="_blank" rel="noreferrer">Nager.Date API</a>.
        ‚ÄúSilly‚Äù holidays from a tiny built-in list you can extend.
      </div>
    </section>
  </div>

<script>
/* ---------- data & mappings ---------- */
const COUNTRY_LIST=[["US","United States"],["CA","Canada"],["GB","United Kingdom"],["AU","Australia"],["IE","Ireland"],["DE","Germany"],["FR","France"]];
const FUN_HOLIDAYS={"01-01":["New Year‚Äôs Day (Fun)","Bloody Mary Day"],"02-14":["Valentine‚Äôs (Fun)","International Book Giving Day"],"03-14":["Pi Day","Potato Chip Day"],"03-17":["St. Patrick‚Äôs (Fun)"],"04-01":["April Fools‚Äô Day"],"05-04":["Star Wars Day"],"06-01":["Say Something Nice Day"],"09-19":["Talk Like a Pirate Day"],"10-09":["Leif Erikson Day"],"10-31":["Halloween (Fun)"],"11-13":["World Kindness Day"],"11-23":["Espresso Day"],"12-25":["Christmas (Fun)"]};
const TEMPLATES={"st patrick":"shamrock","leif erikson":"viking","valentine":"valentine","thanksgiving":"turkey","halloween":"pumpkin","christmas":"tree","new year":"firework","talk like a pirate":"parrot","pi":"pi","coffee":"coffee","espresso":"coffee","donut":"donut","pizza":"pizza","taco":"taco"};
const EMOJI={shamrock:["‚òòÔ∏è","üçÄ"],viking:["üõ°Ô∏è","‚öîÔ∏è","ü™ñ"],valentine:["üíò","üíñ","üíå"],turkey:["ü¶É","üçó"],pumpkin:["üéÉ"],tree:["üéÑ","üå≤"],firework:["üéÜ","üéá"],parrot:["ü¶ú","üè¥‚Äç‚ò†Ô∏è"],pi:["ü•ß","üî¢"],coffee:["‚òïÔ∏è","üí§"],donut:["üç©"],pizza:["üçï"],taco:["üåÆ"],default:["üéâ","üéà","‚ú®","ü•≥","üåü","üòä","üí´"]};

/* ---------- local-date utils (no UTC) ---------- */
function toYMDLocal(d){const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),day=String(d.getDate()).padStart(2,'0');return `${y}-${m}-${day}`;}
function toMMDDLocal(d){const m=String(d.getMonth()+1).padStart(2,'0'),day=String(d.getDate()).padStart(2,'0');return `${m}-${day}`;}
function fromInputLocal(v){if(!v)return new Date();const [y,m,d]=v.split('-').map(Number);return new Date(y,m-1,d,12,0,0);}
function todayInputValue(){return toYMDLocal(new Date());}
function titleCase(s){return s.replace(/\b([a-z])/g,m=>m.toUpperCase());}
function ymdToLocalDate(ymd){const [y,m,d]=ymd.split('-').map(Number);return new Date(y,m-1,d,12,0,0);}

/* ---------- DOM ---------- */
const dateEl=document.getElementById('date');
const countryEl=document.getElementById('country');
const statusEl=document.getElementById('status');
const holidaysEl=document.getElementById('holidays');
const outputEl=document.getElementById('output');
const includeOfficialEl=document.getElementById('includeOfficial');
const includeFunEl=document.getElementById('includeFun');
const bundleEl=document.getElementById('bundle');
dateEl.value=todayInputValue();
COUNTRY_LIST.forEach(([c,n])=>{const o=document.createElement('option');o.value=c;o.textContent=`${n} (${c})`;countryEl.appendChild(o);});

/* ---------- official holiday cache ---------- */
const OFFICIAL_CACHE = new Map(); // key: `${year}:${country}` -> Set(ymd strings)
async function getOfficialSet(year,country){
  const key=`${year}:${country}`;
  if(OFFICIAL_CACHE.has(key)) return OFFICIAL_CACHE.get(key);
  const url=`https://date.nager.at/api/v3/PublicHolidays/${year}/${country}`;
  const res=await fetch(url,{mode:'cors'});
  if(!res.ok) throw new Error('Nager.Date fetch failed');
  const data=await res.json();
  const set=new Set(data.map(h=>h.date)); // h.date already "YYYY-MM-DD"
  OFFICIAL_CACHE.set(key,set);
  return set;
}

/* ---------- fun holiday set for a given year ---------- */
function getFunSetForYear(year){
  const set=new Set();
  for(const mmdd of Object.keys(FUN_HOLIDAYS)){
    set.add(`${year}-${mmdd}`);
  }
  return set;
}

/* ---------- build eligible dates respecting toggles ---------- */
async function getEligibleDates(year,country,{official,fun}){
  const out=new Set();
  if(fun){ for(const d of getFunSetForYear(year)) out.add(d); }
  if(official){
    try{
      const off=await getOfficialSet(year,country);
      for(const d of off) out.add(d);
    }catch(e){
      // if official fetch fails, we just skip official side
      console.warn(e);
    }
  }
  return [...out].sort(); // array of ymd strings
}

/* ---------- per-day fetch & generate ---------- */
async function fetchOfficialForDate(dateLocal,country){
  const y=dateLocal.getFullYear();
  const set=await getOfficialSet(y,country);
  const ymd=toYMDLocal(dateLocal);
  // We need names, not just dates; fetch list again here and filter for names (kept as before for simplicity)
  const url=`https://date.nager.at/api/v3/PublicHolidays/${y}/${country}`;
  const res=await fetch(url,{mode:'cors'});
  if(!res.ok) throw new Error('Nager.Date list failed');
  const all=await res.json();
  return all.filter(h=>h.date===ymd).map(h=>h.name);
}
function fetchFun(dateLocal){return (FUN_HOLIDAYS[toMMDDLocal(dateLocal)]||[]).slice();}

function nounFromName(n){
  const low=n.toLowerCase();
  for(const k in TEMPLATES){ if(low.includes(k)) return TEMPLATES[k]; }
  const t=low.match(/[a-z]+/g)||[];
  for(let i=t.length-1;i>=0;i--){
    if(["day","week","month","international","national","world","the"].includes(t[i])) continue;
    return t[i];
  }
  return "hero";
}
function pickEmojis(noun){
  const arr=EMOJI[noun]||EMOJI.default;
  const copy=arr.slice();
  const n=Math.min(2,Math.max(1,Math.floor(Math.random()*2)+1));
  return Array.from({length:n},()=>copy[Math.floor(Math.random()*copy.length)]).join(" ");
}
function craftMessage(name){
  const noun=nounFromName(name);
  return `Be my ${titleCase(noun)} ${pickEmojis(noun)} ‚Äî Happy ${name}!`;
}

async function generate(){
  statusEl.textContent="Fetching‚Ä¶";holidaysEl.innerHTML="";outputEl.textContent="";
  const dateLocal=fromInputLocal(dateEl.value);
  const country=countryEl.value||"US";
  let names=new Set();

  try{
    if(includeOfficialEl.checked){
      (await fetchOfficialForDate(dateLocal,country)).forEach(n=>names.add(n));
    }
  }catch(e){
    console.warn(e);
    statusEl.textContent="Official holidays unavailable; showing fun holidays only.";
  }
  if(includeFunEl.checked){ fetchFun(dateLocal).forEach(n=>names.add(n)); }

  const list=[...names];
  if(list.length===0){
    holidaysEl.innerHTML="<div class='muted'>No holidays found for this date.</div>";
    outputEl.textContent=""; statusEl.textContent="";
    return;
  }

  list.forEach(n=>{
    const el=document.createElement('span'); el.className='pill'; el.textContent=n;
    holidaysEl.appendChild(el);
  });

  let messages=list.map(craftMessage);
  if(bundleEl.checked){ messages=[list.map(n=>`‚Ä¢ ${craftMessage(n)}`).join("\n")]; }
  outputEl.textContent=messages.join("\n\n");
  statusEl.textContent=`Generated ${messages.length} message${messages.length>1?'s':''}.`;
}

function copyOut(){
  const text=outputEl.textContent.trim(); if(!text) return;
  navigator.clipboard.writeText(text).then(()=>{ statusEl.textContent="Copied ‚úÖ"; });
}

/* ---------- Random Holiday (only valid dates) ---------- */
document.getElementById('random').addEventListener('click', async ()=>{
  statusEl.textContent="Finding a holiday day‚Ä¶";
  const year = new Date().getFullYear();
  const country = countryEl.value || "US";
  const useOfficial = includeOfficialEl.checked;
  const useFun = includeFunEl.checked;

  const eligible = await getEligibleDates(year, country, {official: useOfficial, fun: useFun});
  if(eligible.length === 0){
    statusEl.textContent = "No eligible holiday dates found with current filters.";
    return;
  }
  const pick = eligible[Math.floor(Math.random()*eligible.length)];
  dateEl.value = pick; // already YYYY-MM-DD
  statusEl.textContent = `Random holiday picked: ${ymdToLocalDate(pick).toDateString()}`;
  generate();
});

/* ---------- wiring ---------- */
document.getElementById('go').addEventListener('click',generate);
document.getElementById('today').addEventListener('click',()=>{dateEl.value=todayInputValue();generate();});
document.getElementById('shuffle').addEventListener('click',()=>{
  const pills=[...document.querySelectorAll('.pill')].map(p=>p.textContent);
  if(!pills.length) return;
  let messages=pills.map(craftMessage);
  if(bundleEl.checked) messages=[pills.map(n=>`‚Ä¢ ${craftMessage(n)}`).join("\n")];
  outputEl.textContent=messages.join("\n\n");
  statusEl.textContent="Refreshed üé≤";
});
/* ---------- load full fun-holiday JSON (from timeanddate) ---------- */
let FUN_BY_DATE = {};

async function loadFunJson(){
  try {
    const res = await fetch('./fun_holidays_by_date.json', {cache:'no-store'});
    FUN_BY_DATE = await res.json();
    console.log(`Loaded ${Object.keys(FUN_BY_DATE).length} fun-holiday dates.`);
  } catch(e){
    console.warn("Fun JSON not found, falling back to built-ins.", e);
  }
}

/* Replace the old fetchFun() with this one */
function fetchFun(dateLocal){
  const ymd = toYMDLocal(dateLocal);
  const mmdd = ymd.slice(5); // "MM-DD"
  const names = FUN_BY_DATE[ymd] || (FUN_HOLIDAYS[mmdd] || []);
  return names.slice();
}

/* Load JSON first, then generate */
(async () => {
  await loadFunJson();
  generate();
})();
</script>
</body>
</html>

generate();
</script>
</body>
</html>
